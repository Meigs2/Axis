@page "/Data"
@inject IJSRuntime JS
@inject IMasterControlUnit mcu;
@using System.Reactive.Linq
@using System.Diagnostics
@using Axis.Core
@implements IDisposable

<h3>Data</h3>

<div class="container h-full w-full">
    <canvas id="myChart"></canvas>
</div>

@code {
    private IJSObjectReference? jsModule;
    private IDisposable subscription;
    private Stopwatch _stopwatch;
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _stopwatch = new Stopwatch();
            _stopwatch.Start();
            jsModule = await JS.InvokeAsync<IJSObjectReference>("import", "./Pages/Data.razor.js");

            subscription = mcu.AdsReadouts.Select(x => AppendData(x.value)).Subscribe();
        }
    }

    public async Task AppendData(double data)
    {
        await jsModule.InvokeVoidAsync("addData", data);
    }

    public void Dispose()
    {
        jsModule?.DisposeAsync();
        subscription?.Dispose();
    }

}